# توثيق مشروع CineFit Pro: المخرج الفني ومصمم الأزياء الذكي

## 1. نظرة عامة (Overview)
**CineFit Pro** هو تطبيق ويب متقدم مبني باستخدام **React 19** و **TypeScript**، يهدف إلى مساعدة صناع الأفلام ومصممي الأزياء من خلال دمج الذكاء الاصطناعي التوليدي (Generative AI) في عملية الإنتاج السينمائي.

يعتمد النظام بشكل أساسي على **Google Gemini API** (النماذج متعددة الوسائط) للقيام بمهمتين رئيسيتين:
1.  **المخرج الفني (Costume Director):** تحليل السيناريو، الحالة النفسية للشخصيات، وظروف التصوير لاقتراح تصميم أزياء كامل مع تبرير درامي وتوليد صورة تخيلية (Concept Art).
2.  **غرفة القياس الافتراضية (Virtual Fitting Room):** تجربة الأزياء افتراضيًا على صور الممثلين الحقيقية، مع مراعاة فيزياء القماش وظروف الإضاءة والطقس المستنتجة من المرحلة السابقة.

---

## 2. التقنيات المستخدمة (Tech Stack)

*   **الواجهة الأمامية (Frontend):** React 19, TypeScript, Vite.
*   **التصميم (Styling):** Tailwind CSS (Utility-first styling), Framer Motion (للتحريكات).
*   **الذكاء الاصطناعي (AI Core):** Google GenAI SDK (`@google/genai`).
    *   **Gemini 2.5 Flash:** لتحليل النصوص، استدعاء الأدوات (Tools)، وتوليد هيكل البيانات (JSON).
    *   **Gemini 2.5 Flash Image:** لتوليد الصور التخيلية (Text-to-Image) ودمج الصور (Image-to-Image / Virtual Try-on).

---

## 3. القدرات التقنية الأساسية (Core Capabilities)
يعتمد النظام في عملياته المعقدة لمعالجة الصور والمحاكاة على طبقات تقنية متقدمة يتم تنفيذها عبر نماذج الذكاء الاصطناعي التوليدي:

├─ **Computer Vision (رصد ملامح الممثل):** تحديد دقيق لهيكل الجسم والوجه لضمان تركيب الأزياء دون تشويه الملامح الأصلية.
<br>
├─ **Pose Estimation (قياس الحركة والتشريح):** فهم وضعية الممثل (الوقوف، الجلوس، الحركة) لضبط انسيابية الملابس بشكل طبيعي.
<br>
├─ **Physics Simulation (محاكاة القماش):** محاكاة تفاعل الخامات (حرير، جلد، صوف) مع الجاذبية والحركة وظروف الطقس (مثل البلل أو الرياح).
<br>
├─ **Lighting Synthesis (محاكاة الإضاءة):** دمج الإضاءة السينمائية المخطط لها (أو الموجودة في صورة الممثل) مع الزي الجديد لضمان الواقعية (Photorealism).
<br>
└─ **Real-time Rendering (عرض فوري):** توليد النتائج بسرعة عالية لتمكين اتخاذ القرارات الإنتاجية في الوقت الفعلي.

---

## 4. الهيكلية البرمجية (Architecture & Modules)

### أ. ملف التشغيل الرئيسي (`App.tsx`)
يعمل هذا الملف كمدير للحالة (State Manager) وموجه (Router) بسيط للتطبيق.
*   **إدارة الحالة:** يحتفظ بحالة "الوضع الحالي" (`mode`) سواء كان المستخدم في الصفحة الرئيسية، وضع المخرج، أو غرفة القياس.
*   **نقل البيانات:** يقوم بنقل مخرجات التحليل (التصميم، الطقس، القيود الإنتاجية) من `Director Mode` إلى `Fitting Mode` عبر كائن الحالة `designToFit`.

### ب. خدمات الذكاء الاصطناعي (`services/geminiService.ts`)
هذا هو "عقل" التطبيق، ويحتوي على وظيفتين رئيسيتين:

#### 1. `generateProfessionalDesign` (تحليل السيناريو)
تقوم هذه الدالة باستقبال "موجز التصميم" (`DesignBrief`) وتنفيذ الخطوات التالية:
*   **System Instruction:** تم تزويد النموذج بتعليمات صارمة للعمل كخبير أزياء سينمائي، مع التركيز على **الانعكاس النفسي (Psychological Mirroring)** للأزياء على الشخصية.
*   **Tool Use (Function Calling):** تستخدم أداة `get_filming_location_conditions` لجلب حالة الطقس (محاكاة) للموقع المذكور في السيناريو.
*   **Output:** تطلب من النموذج إخراج النتيجة بتنسيق JSON صارم يحتوي على تفاصيل الزي، التبرير الدرامي، وملاحظات الإنتاج باللغة العربية.
*   **Image Generation:** تستخدم وصف الزي المنتج لتوليد صورة "Concept Art" عالية الدقة.

#### 2. `generateVirtualFit` (القياس الافتراضي)
تقوم هذه الدالة بدمج صورة الممثل مع صورة الزي:
*   **Inputs:** صورة الممثل (Base64)، صورة الزي (Base64)، وصف الزي، وسياق البيئة (`context`).
*   **Context Awareness:** يتم تمرير "سياق البيئة" (مثل الطقس الممطر، أو قيود الكاميرا) إلى النموذج ليقوم بتعديل فيزياء القماش والإضاءة لتتناسب مع هذا السياق (مثلاً: جعل القماش يبدو مبتلاً أو ثقيلاً).
*   **Processing:** يستخدم النموذج قدراته متعددة الوسائط لإنتاج صورة جديدة تحافظ على ملامح الممثل وتستبدل الملابس بواقعية.

### ج. المكونات الرئيسية (Components)

#### `StartScreen.tsx`
*   واجهة تفاعلية متعددة الخطوات لجمع بيانات المشروع (نوع الفيلم، المشهد، الحالة النفسية للشخصية، موقع التصوير).

#### `FittingRoom.tsx`
*   واجهة المستخدم الخاصة بتجربة الأزياء.
*   **الميزات:**
    *   إجبار المستخدم على رفع صورة الممثل أولاً.
    *   عرض "قيود المخرج" (Director's Constraints) التي تم استلامها من المرحلة السابقة.
    *   إدارة خزانة الملابس (اختيار زي تم توليده أو رفع زي خارجي).
    *   استدعاء `generateVirtualFit` مع دمج بيانات الطقس والقيود في متغير واحد (`fitContext`).

#### `Canvas.tsx`
*   مكون لعرض النتيجة النهائية للصورة، ويدعم عرض حالات التحميل (Spinners).

---

## 5. تدفق البيانات (Data Flow Workflow)

1.  **الإدخال (StartScreen):** يدخل المستخدم: "فيلم نوار، مشهد مطاردة، شخصية متوترة، تصوير في لندن".
2.  **التحليل (Gemini Service):**
    *   الذكاء الاصطناعي يستنتج: الطقس في لندن بارد وغائم.
    *   يقترح: معطف طويل (Trench Coat) يعكس الغموض، بياقة مرفوعة (حماية/تخفي).
    *   المخرجات: JSON (تفاصيل) + صورة (Concept Art).
3.  **الانتقال (App.tsx):** عند الضغط على "Try on Actor"، يتم تمرير وصف الزي + حالة الطقس (بارد/غائم) + قيود الكاميرا إلى `FittingRoom`.
4.  **التجهيز (FittingRoom):**
    *   المستخدم يرفع صورة الممثل.
    *   يتم دمج السياق: "Weather: Overcast & Chilly. Notes: Avoid pure white".
5.  **التوليد (Gemini Service):**
    *   يتم إرسال صورة الممثل + صورة المعطف + السياق.
    *   النتيجة: صورة للممثل يرتدي المعطف، وتبدو الخامات ثقيلة ومناسبة للجو البارد، مع إضاءة درامية مطابقة للصورة الأصلية.

---

## 6. دليل التعديل والتطوير (Development Guide)

### إضافة أدوات جديدة للذكاء الاصطناعي
لتوسيع قدرات التحليل، قم بتعريف `FunctionDeclaration` جديدة في `geminiService.ts` وأضفها إلى مصفوفة `tools`.

### تعديل سلوك الشخصية النفسي
تم تحديث التعليمات (System Instructions) في `geminiService.ts` لتركز على `Psychological Mirroring`. لتغيير هذا السلوك، قم بتعديل النص داخل متغير `systemInstruction`.

### التعامل مع الأخطاء
يحتوي المشروع على دالة مساعدة `getFriendlyErrorMessage` في `lib/utils.ts` تقوم بترجمة أخطاء API التقنية (مثل مشاكل MIME Types) إلى رسائل مفهومة للمستخدم.

---

## 7. المتطلبات والتشغيل (Setup)

1.  تأكد من وجود `Node.js` مثبت.
2.  احصل على مفتاح API من [Google AI Studio](https://aistudio.google.com/).
3.  أنشئ ملف `.env` وأضف المفتاح: `API_KEY=your_key_here`.
4.  ثبت الحزم: `npm install`.
5.  شغل التطبيق: `npm run dev`.

---

حقوق الملكية محفوظة © CineFit Studio - 2025